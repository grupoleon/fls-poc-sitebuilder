# =============================================================================
# FLS POC Site Builder - Nixpacks Configuration
# =============================================================================
# Let Nixpacks auto-detect PHP - only customize install and start phases
# =============================================================================

[phases.install]
cmds = [
    # Install required system packages for deployment scripts
    "apt-get update -qq",
    "apt-get install -y -qq jq openssh-client openssl git curl rsync python3 python3-pip",
    # Install PyNaCl for SSH key support (try apt first, fallback to pip)
    "apt-get install -y -qq python3-pynacl || pip3 install --break-system-packages pynacl",
    # Create application directories
    "mkdir -p /app/config /app/logs /app/logs/api /app/logs/deployment /app/tmp /app/uploads /app/.ssh /app/webhook/tasks",
    "mkdir -p /var/log/nginx",
    # Set proper permissions
    "chmod 777 /app/config /app/logs /app/tmp /app/uploads /app/webhook",
    "chmod 755 /app/logs/api /app/logs/deployment /app/webhook/tasks",
    "chmod 700 /app/.ssh"
]

[start]
cmd = "bash scripts/kinsta-start.sh"

[variables]
APP_ENV = "production"
TZ = "UTC"
